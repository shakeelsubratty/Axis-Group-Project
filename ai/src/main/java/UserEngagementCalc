import java.text.DecimalFormat;
import java.util.ArrayList;

public class UserEngagementCalc {

    private ArrayList<Participant> participants;
    private double numParticipants;
    private double workshopTotalResp;
    private double workshopAverage;
    private double midBad;
    private double mid;
    private double upperMid;
    private double numEngaged;

    public UserEngagementCalculator(ArrayList<Participant> x)
    {
        participants = x;
        numParticipants = participants.size();
        if (participants.size()!=0)
        {
            for (Participant z: participants)
            {
                workshopTotalResp += z.getNumResponses();
            }
        }
        else
        {
            workshopTotalResp= 0;
        }
        for (Participant z: participants)
        {
            workshopAverage += (z.computeAverage()*z.getNumResponses());
        }
        workshopAverage = workshopAverage/workshopTotalResp;

        mid= 1/numParticipants;
        midBad=mid/2;
        upperMid= mid + midBad;
    }

    public void calculateLevel(){
        for (Participant y: participants)
        {
            double numerator =  (y.getNumResponses()/workshopTotalResp) ;
            double denominator = y.fetchAverage()/workshopAverage ;
            double finalLevel = numerator*denominator;
            y.setLevel(finalLevel);

            if ((0<= finalLevel) && (finalLevel< midBad))
            {
                y.setStringLevel("Terrible - must fire!");
            }
            else if ((midBad<= finalLevel) && (finalLevel< mid))
            {
                y.setStringLevel("Unengaged");
            }
            else if ((mid<= finalLevel) && (finalLevel< upperMid))
            {
                y.setStringLevel("Engaged");
            }
            else if ((upperMid<= finalLevel) && (finalLevel<= 1))
            {
                y.setStringLevel("Superstar- give them a raise!");
            }

        }

    }

    public double calculateOverAllEngagement()
    {
        for (Participant x: participants)
        {
            if (((x.getStringLevel()).equals("Engaged"))|| ((x.getStringLevel()).equals("Superstar- give them a raise!")))
            {
                numEngaged++;
            }
        }
        double percentage = ((numEngaged/numParticipants)*100);
        DecimalFormat df = new DecimalFormat("##.##");
        percentage = Double.valueOf(df.format(percentage));
        return percentage;
    }



}
